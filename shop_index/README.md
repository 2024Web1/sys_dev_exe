# ジャンル選択画面の作成(ビュー、ルーティング)

- [ジャンル選択画面の作成(ビュー、ルーティング)](#ジャンル選択画面の作成ビュールーティング)
  - [事前準備](#事前準備)
  - [はじめに](#はじめに)
  - [Laravel環境の構築](#laravel環境の構築)
  - [ビューについて](#ビューについて)
  - [Bladeテンプレートについて](#bladeテンプレートについて)
  - [ジャンル選択画面の作成](#ジャンル選択画面の作成)
  - [ルーティングについて](#ルーティングについて)
  - [まとめ](#まとめ)

## 事前準備

[こちらのページ]()から、ソースコードを`C:¥sys_dev_exe`へcloneしてください。

## はじめに

LaravelはPHPで書かれたフレームワークで、モダンなウェブアプリケーションを効率的に開発するための強力なツールです。
本章では、Laravelの基本的な機能であるビュー(Bladeテンプレート)、ルーティングについて学びます。
これらの基礎を理解することで、Laravelを使用したWebアプリケーション開発の第一歩を踏み出すことができます。

## Laravel環境の構築

後期の授業も、前期同様**コンテナを起動しアプリケーションを実行する**ことは変わりません。
ですが、Laravel環境を構築する上で、前期とは違った手順を踏む必要があります。

以降の章でも同じことを繰り返しやっていくことになりますので、しっかりと理解しておきましょう。

1. VSCode上で、`Ctrl+Shift+P`(Macの場合は`Cmd+Shift+P`)を押し、コンテナを起動する(**※初回のみ時間がかかる**)
2. VSCode上で、`Ctrl+J`(Macの場合は`Cmd+J`)を押し、ターミナルを表示する
3. ターミナルに`composer create-project laravel/laravel .` と入力し、`Enter`で実行する<br>
   ![](./images/composer_command_1.png)
4. 30秒〜1分ぐらいして、以下のような表示がでれば、プロジェクトの作成完了となる(※2回目以降、コンテナを起動後に、上記コマンド`composer create-project laravel/laravel .`を実行する必要なし)<br>
   ![](./images/composer_command_2.png)
5. 画面下部のポートをクリックし、地球儀マークをクリックする<br>
   ![](./images/port_click.png)
6. 以下のような、画面が表示されればOK<br>
   ![](./images/welcome_page.png)

## ビューについて

ビューは、MVCモデルでいうところの「V(View)」に相当します。<br>
![](./images/mvc_v.png)

ビューは、ユーザーに表示されるWebページのことを指します。
LaravelではBladeテンプレートエンジンを使用することで、より動的で再利用可能なコンテンツを作成することができます。

## Bladeテンプレートについて

Bladeテンプレートは、Laravelのテンプレートエンジンで、よりクリーンで保守しやすいHTMLを書くことができます。
ここでいうテンプレートエンジンとは、HTMLテンプレート内に変数や制御構造を埋め込むための仕組み(`{{  }}`やディレクティブ(`@`)など)のことです。

通常のHTMLファイルでは動作しないため、必ずファイル名には「.blade.php」という拡張子をつけることを忘れないようにしましょう。

## ジャンル選択画面の作成

まずは、ジャンル選択画面(index.blade.php)の内容を確認してみましょう。
このファイルは、簡単なHTMLテンプレートで、ユーザーがジャンルを選択するフォームです。
なお、Bladeテンプレートの配置場所については、resources/viewsディレクトリ内に配置されます。

**resources/views/index.blade.php**

```php
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ショッピングサイト</title>
</head>
<body>
<h3>ジャンル選択</h3>
<!-- action属性の値についてはここでは空欄とします-->
<form method="POST" action="">
    @csrf
    <label><input type="radio" name="genre" value="pc">パソコン</label>&nbsp;&nbsp;
    <label><input type="radio" name="genre" value="book" checked>ブック</label>&nbsp;&nbsp;
    <label><input type="radio" name="genre" value="music">ミュージック</label>&nbsp;&nbsp;
    <input type="submit" value="選択">
</form>
</body>
</html>
```

前期と違う記載方法がありますので解説します。

**【解説】**

`@csrf`<br>
Bladeテンプレートでは、上記のように`@`から始まる**ディレクティブ**を使って、特定の処理を行うことができます。
`@csrf`ディレクティブは、Laravelが自動的にCSRFトークンを生成し、フォーム送信時のセキュリティを強化します。

ここでいうCSRFトークンとは、クロスサイトリクエストフォージェリ(CSRF)攻撃からアプリケーションを保護するためのセキュリティ対策の一つです。
CSRFトークンを使うことで、フォーム送信時に外部からの不正なリクエストを防ぐことができます。

※Laravelのデフォルトの設定では、`<form>`タグを使用する際には、必ず`@csrf`ディレクティブを記述する必要があり、記載しないとエラーが発生します。

## ルーティングについて

Laravelにおけるルーティングとは、URLとアプリケーション内の特定のロジックをマッピングすることを指します。

ここでいうマッピングとは、特定のURLにアクセスしたときにどのビューやコントローラを呼び出すかを定義することです。(※コントローラについて別の章で後述します。)

ルーティングを定義するメリットは、アプリケーションのURL構造を簡潔に保ち、**コードの可読性を向上させることができる**点です。
ただし、可読性の向上について実感できるのは、後期授業が進み、扱うPHPファイルが増えたときになりますのでしばしお待ちを。

では、Laravelのルーティングを定義する方法を見ていきましょう。
routes/web.php ファイルには、ウェブリクエストを処理するためのすべてのルートが含まれています。
それでは、routes/web.php ファイルを以下のように書き換えましょう。

**routes/web.php**

```php
<?php

use Illuminate\Support\Facades\Route;

// デフォルトのルート設定はコメントアウトしてください
// Route::get('/', function () {
//     return view('welcome');
// });

Route::get('/', function () {
    return view('index');
})->name('index');
```

**【解説】**

`Route`: `Route`クラスは、Laravelのルーティングを定義するためのクラスです。

`Route::get`:<br> 
`Route::get`メソッドは、GETリクエストを処理するためのルートを定義します。(※PHPでは、前期授業で述べた通り、何もしていなければリクエスト時に使用されるメソッドはGETメソッドです。)

`Route::get`メソッドの第1引数は、URLを指定します。
上記の例では、`/` となっています。
第2引数は、クロージャです。
クロージャは、指定されたURLにアクセスされたときに実行される処理を定義します。
Laravelでは、クロージャを使って、ルートに直接ロジックを記述することができます。

上記の例では、`return view('index');` は、`index.blade.php`ビューを返す処理を定義しています。
また、`->name('index')` は、このルートに名前を付けるためのメソッドです。
名前を付けることで、ビューなどからルートを参照する際に、URLを直接記述するのではなく、名前を使って参照することができ便利です。

ここまでプログラムが作成できたら、ブラウザでアクセスしてみましょう。
以下のような画面が表示されればOKです。

![](./images/index.png)

なぜこの画面が表示されるのか、理由を考えてみましょう。

それは、`Route::get('/', function () { return view('index'); })->name('index');` で、`/` にアクセスしたときに、`index.blade.php` ビューを返すように設定したからです。

## まとめ

今回学んだ内容は、index.blade.phpファイルを通じて、Laravelの基本的な機能であるビュー、Bladeテンプレート、そしてルーティングの使い方について紹介しました。

次回以降の授業では、コントローラの使い方やデータベースとの連携について学びます。
